#' @title Mapping of FastCAT data
#'
#' @description Once make_dataframe_fc() has been run, then map_fc can be
#' used. This function makes a station map from the dataframe generated.
#' The rendered map will be located in the plot folder within the current
#' folder.
#' @param current_path The path to the directory where the .csv file
#' generated by make_dataframe_fc is located.
#' @return A station map



map_fc <- function(current_path){

# find and read in the file created by make_dataframe_fc()---------------------

fc_data <- readr::read_csv(list.files(path = current_path,
                                      pattern = "\\EcoDAAT.csv$",
                                      ignore.case = TRUE,
                                      include.dirs = TRUE,
                                      full.names = TRUE),
                    col_types = cols(CRUISE = col_character(),
                                     STATION_NAME = col_integer(),
                                     HAUL_NAME = col_integer(),
                                     FOCI_GRID = col_character(),
                                     DATE = col_date(),
                                     LAT = col_double(),
                                     LON = col_double(),
                                     DEPTH_BOTTOM = col_integer(),
                                     DEPTH = col_integer(),
                                     TEMPERATURE1 = col_double(),
                                     SALINITY1 = col_double()))%>%
            dplyr::select(CRUISE, STATION_NAME, HAUL_NAME, FOCI_GRID,
                          DATE, LAT, LON, DEPTH_BOTTOM, DEPTH,
                          TEMPERATURE1, SALINITY1)

# bring in the shape files to make the basemap --------------------------------

MAP <- sf::st_read(dsn = "inst/extdata",layer = "Alaska_dcw_polygon_Project")

# tranform into WGS84 coordinate system----------------------------------------

MAP <- sf::st_transform(MAP, "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs")

# bring in 200m bathymetry contour --------------------------------------------

BATH_200 <- sf::st_read(dsn = "inst/extdata", layer = "ne_10m_bathymetry_K_200")

# transform into WGS84 coordinate system---------------------------------------

BATH_200 <- sf::st_transform(BATH_200,
                         "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs")

# coordinate bounding box for map----------------------------------------------

fc_xlim <- c(min(fc_data$LON, na.rm = TRUE) - 2,
             max(fc_data$LON, na.rm = TRUE) + 2)
fc_ylim <- c(min(fc_data$LAT, na.rm = TRUE) - 2,
             max(fc_data$LAT, na.rm = TRUE) + 2)


# Station map data if Station.haul---------------------------------------------

Station_map <- fc_data %>%
  dplyr::select(CRUISE, STATION_NAME, HAUL_NAME, LAT, LON)%>%
  tidyr::unite(STATION_HAUL, STATION_NAME, HAUL_NAME, sep = ".")%>%
  dplyr::distinct(STATION_HAUL, .keep_all = TRUE)


# map--------------------------------------------------------------------------

fc_map <- ggplot2::ggplot()+
  ggplot2::geom_sf(color = "black", data = BATH_200[3], alpha = 0)+
  ggplot2::geom_sf(fill ="#a7ad94", color = "black", data = MAP[1])+
  supressWarnings(ggspatial::annotation_scale(location = "bl",
                                              width_hint = 0.5))+
  ggplot2::coord_sf(xlim = fc_xlim, ylim = fc_ylim)+
  ggplot2::geom_point(aes(LON, LAT), size = 6, shape = 21, color = "black",
                      fill = "orange", data = Station_map)+
  ggplot2::geom_text(aes(LON, LAT, label = STATION_HAUL), size = 3,
                     nudge_x = 0.1, nudge_y = 0.15, data = Station_map)+

  ggplot2::theme_bw()+
  ggplot2::xlab(label = "Longitude")+
  ggplot2::ylab(label = "Latitude")+
  ggplot2::theme(
    axis.text.y = element_text(face = "bold", size = 12),
    axis.text.x = element_text(face = "bold", size = 12),
    axis.title = element_text(face = "bold", size = 18),
    strip.text = element_text(face = "bold", size = 18),
    legend.title = element_text(face = "bold",size = 16),
    legend.text = element_text(face = "bold", size = 16))

return(fc_map)
}




